# Stellar - Game Design Document
## 3D Space RTS Based on OpenFront.io

### Core Concept
Stellar is a 3D space real-time strategy game where players compete for galactic domination by controlling solar systems, building space infrastructure, and engaging in tactical warfare across three-dimensional space. Victory requires controlling 80% of the galaxy.

### Technical Stack
- **Frontend**: Three.js for 3D rendering, React for UI
- **Backend**: Supabase (PostgreSQL)
- **Hosting**: Web-based, no download required
- **API URL**: `https://chnccetbqkaqbkekjzbv.supabase.co`
- **API Key**: Will be stored in environment variables

---

## 1. CORE GAMEPLAY MECHANICS

### 1.1 Victory Conditions
- **Win**: Control 80% of all solar systems
- **Lose**: Control 0 solar systems (elimination)
- **Draw**: Time limit reached (optional game mode)

### 1.2 3D Space Grid System
- Galaxy divided into **sectors** (replacing 2D tiles)
- Each sector contains 0-3 solar systems
- Movement allowed in all 3 dimensions (X, Y, Z)
- Spherical influence zones around controlled systems
- Distance-based travel times between sectors

### 1.3 Territory Control
- **Solar Systems** = primary control points (replacing land tiles)
- **Asteroid Fields** = resource-rich zones (replacing terrain variations)
- **Nebulas** = defensive zones with visibility reduction
- **Empty Space** = fast travel corridors

---

## 2. RESOURCES

### 2.1 Primary Resources
- **Energy** (replaces troops): Generated by controlled systems
  - Base generation: 1000 + (systems^0.6 * 100)
  - Max capacity: 2 * (baseCap) + stationBonus
  - Optimal efficiency at 42% capacity
- **Credits** (replaces gold): Flat generation + trade
  - Players: 100/tick
  - AI: 50/tick
  - Additional from trade routes and conquests

### 2.2 Secondary Resources
- **Minerals**: Mined from asteroid fields, used for construction
- **Research Points**: Generated by research stations, unlock upgrades

---

## 3. UNITS & FLEETS

### 3.1 Fleet Types
- **Scout Fleet**: Fast, weak, good for exploration
- **Attack Fleet**: Standard combat unit
- **Defense Fleet**: Slow, strong, area defense
- **Carrier Fleet**: Deploys fighters in combat
- **Trade Fleet**: Generates credits on routes

### 3.2 Fleet Mechanics
- Fleets consume energy based on size
- Travel time = distance / speed
- Can merge/split fleets
- Auto-retreat at 20% strength

---

## 4. STRUCTURES (Space Stations)

### 4.1 Economic Structures
- **Trade Station** (Port): 50,000 credits
  - Spawns trade ships
  - Enables fleet construction
  - Trade income scales with distance
  
- **Mining Station** (Factory): 50,000 credits
  - Extracts minerals from asteroid fields
  - +500 minerals/tick
  
- **Colony Station** (City): 100,000 credits
  - +25,000 energy capacity per level
  - Increases system value

### 4.2 Military Structures
- **Defense Platform** (Defense Post): 25,000 credits
  - 5x combat multiplier in sphere of influence
  - Range: 50 units
  
- **Missile Battery** (Missile Silo): 75,000 credits
  - Required for launching space torpedoes
  - 10-second cooldown
  
- **Point Defense** (SAM): 50,000 credits
  - Intercepts incoming torpedoes
  - 100-unit protection radius
  - 7.5-second cooldown

### 4.3 Warships & Combat Ships
- **Battleship** (Warship): 35,000 credits
  - 1000 HP maximum
  - Attacks enemy ships and trade vessels
  - Homing missile system

### 4.4 Superweapons
- **Antimatter Torpedo** (Atom Bomb): 50,000 credits
  - Small area damage
  - Destroys stations in 20-unit radius
  
- **Nova Bomb** (Hydrogen Bomb): 250,000 credits
  - Large area effect (100-unit radius)
  - Removes 40% of system's energy
  
- **Swarm Missiles** (MIRV): 1,000,000 credits
  - Targets entire enemy empire
  - Hundreds of small warheads

---

## 5. COMBAT SYSTEM

### 5.1 Space Combat Formula
```
AttackPower = BaseAttack * (1 + TechBonus) * TerrainMultiplier
DefensePower = BaseDefense * (1 + StationBonus) * (1 - TraitorPenalty)
Losses = AttackPower / (AttackPower + DefensePower) * DefenderForces
```

### 5.2 Combat Modifiers
- **Nebula Defense**: +50% defense
- **Asteroid Field**: +25% defense, -25% attack speed
- **Empty Space**: +50% attack speed
- **Defense Platform**: 5x defense in range
- **Traitor Status**: -50% defense, -20% attack speed for 30s

### 5.3 3D Combat Considerations
- **Flanking**: Attacks from multiple vectors get +20% bonus
- **Elevation Advantage**: Higher Z-position gives +10% accuracy
- **Encirclement**: Systems surrounded on 6+ sides surrender instantly

---

## 6. AI SYSTEMS

### 6.1 AI Types
- **Pirates** (Bots): Simple AI, no defense marshaling
- **Minor Empires** (Nations): Complex AI with full capabilities
- **Neutral Traders**: Non-combat NPCs for trade routes

### 6.2 Difficulty Scaling
- Easy: AI at 50% efficiency
- Normal: AI at 75% efficiency  
- Hard: AI at 100% efficiency
- Nightmare: AI at 150% efficiency with bonus resources

---

## 7. PROGRESSION & META

### 7.1 Tech Tree (Simplified)
- **Tier 1**: Basic structures, scout fleets
- **Tier 2**: Advanced fleets, defense platforms
- **Tier 3**: Superweapons, mega-structures

### 7.2 Alliance System
- Temporary alliances via diplomatic menu
- Shared vision of allied territories
- Breaking alliance = traitor status
- Trade agreements separate from military alliances

---

## 8. DATABASE SCHEMA (SUPABASE)

### 8.1 Core Tables

```sql
-- Players table
players (
  id uuid PRIMARY KEY,
  username text UNIQUE,
  email text,
  credits integer DEFAULT 10000,
  energy integer DEFAULT 50000,
  minerals integer DEFAULT 1000,
  research_points integer DEFAULT 0,
  created_at timestamp
)

-- Games table  
games (
  id uuid PRIMARY KEY,
  name text,
  status text, -- 'waiting', 'active', 'completed'
  max_players integer,
  victory_condition integer DEFAULT 80,
  tick_rate integer DEFAULT 100,
  created_at timestamp,
  started_at timestamp,
  ended_at timestamp
)

-- Game participants
game_players (
  game_id uuid REFERENCES games,
  player_id uuid REFERENCES players,
  empire_color text,
  is_alive boolean DEFAULT true,
  systems_controlled integer DEFAULT 0,
  placement_order integer,
  PRIMARY KEY (game_id, player_id)
)

-- Solar systems
systems (
  id uuid PRIMARY KEY,
  game_id uuid REFERENCES games,
  name text,
  x_pos float,
  y_pos float,
  z_pos float,
  owner_id uuid REFERENCES players,
  energy_generation integer DEFAULT 100,
  has_minerals boolean DEFAULT false,
  in_nebula boolean DEFAULT false
)

-- Fleets
fleets (
  id uuid PRIMARY KEY,
  game_id uuid REFERENCES games,
  owner_id uuid REFERENCES players,
  fleet_type text,
  size integer,
  current_system uuid REFERENCES systems,
  destination_system uuid REFERENCES systems,
  arrival_time timestamp,
  health integer DEFAULT 100
)

-- Structures
structures (
  id uuid PRIMARY KEY,
  system_id uuid REFERENCES systems,
  owner_id uuid REFERENCES players,
  structure_type text,
  level integer DEFAULT 1,
  health integer DEFAULT 100,
  built_at timestamp
)

-- Trade routes
trade_routes (
  id uuid PRIMARY KEY,
  game_id uuid REFERENCES games,
  owner_id uuid REFERENCES players,
  origin_system uuid REFERENCES systems,
  destination_system uuid REFERENCES systems,
  trade_ship_id uuid,
  credits_per_tick integer,
  active boolean DEFAULT true
)

-- Combat logs
combat_logs (
  id uuid PRIMARY KEY,
  game_id uuid REFERENCES games,
  attacker_id uuid REFERENCES players,
  defender_id uuid REFERENCES players,
  system_id uuid REFERENCES systems,
  attacker_losses integer,
  defender_losses integer,
  winner_id uuid REFERENCES players,
  timestamp timestamp DEFAULT now()
)

-- Alliances
alliances (
  game_id uuid REFERENCES games,
  player1_id uuid REFERENCES players,
  player2_id uuid REFERENCES players,
  formed_at timestamp DEFAULT now(),
  PRIMARY KEY (game_id, player1_id, player2_id)
)
```

### 8.2 Real-time Subscriptions
- System ownership changes
- Fleet movements
- Combat events
- Trade route updates
- Alliance formations/breaks

---

## 9. USER INTERFACE

### 9.1 Camera Controls
- **WASD**: Pan camera in X/Y plane
- **Q/E**: Raise/lower camera (Z-axis)
- **Mouse wheel**: Zoom in/out
- **Right-click drag**: Rotate view
- **Spacebar**: Center on selected

### 9.2 HUD Elements
- **Top bar**: Resources (Energy, Credits, Minerals, Research)
- **Bottom bar**: Selected unit/system info
- **Right panel**: Build menu (hotkeys 1-0)
- **Left panel**: Diplomacy & alliances
- **Minimap**: 3D radar view (corner)

### 9.3 Visual Feedback
- **Influence spheres**: Transparent colored spheres
- **Trade routes**: Animated dotted lines
- **Combat**: Laser beams and explosions
- **Territory borders**: Glowing boundaries
- **Fleet paths**: Projected trajectory lines

---

## 10. PERFORMANCE OPTIMIZATIONS

### 10.1 Rendering
- Level-of-detail (LOD) for distant objects
- Frustum culling for off-screen elements
- Instanced rendering for repeated objects
- Texture atlasing for UI elements

### 10.2 Networking
- Delta compression for state updates
- Client-side prediction for movements
- Server reconciliation for conflicts
- Batch database operations

### 10.3 Gameplay
- Spatial indexing for proximity queries
- Hierarchical pathfinding for fleets
- AI decision caching
- Progressive asset loading

---

## 11. IMPLEMENTATION PRIORITIES

### Phase 1: Core Systems (Week 1)
1. Three.js scene setup with space environment
2. Basic galaxy generation (100 systems)
3. Camera controls and selection
4. Supabase integration & auth
5. Basic multiplayer lobby

### Phase 2: Gameplay (Week 2)
1. Fleet movement and pathfinding
2. Territory control mechanics
3. Resource generation
4. Basic combat resolution
5. System capture mechanics

### Phase 3: Structures (Week 3)
1. All structure types
2. Construction UI
3. Trade route system
4. Defense platforms
5. Superweapons

### Phase 4: Polish (Week 4)
1. AI opponents
2. Alliance system
3. Visual effects
4. Sound effects
5. Performance optimization
6. Balance testing

---

## 12. BALANCE FORMULAS

### Energy Regeneration
```javascript
regenPerTick = (10 + currentEnergy^0.73/4) * (1 - currentEnergy/maxEnergy)
```

### Combat Resolution
```javascript
timeToCapture = baseCaptureTime * terrainMod * (defenderForce/attackerForce)
attackerLosses = defenderForce * defenseMod * (1 - techAdvantage)
```

### Trade Income
```javascript
creditsPerTick = baseIncome * (1 + distance/100) * safetyMultiplier
```

### AI Aggressiveness
```javascript
attackProbability = (myStrength/enemyStrength) * difficultyMod * opportunityFactor
```

---

## KEY DIFFERENCES FROM OPENFRONT

1. **3D Space**: Full 3D movement and positioning
2. **Solar Systems**: Replace individual land tiles
3. **Fleet-based**: Units are fleets, not raw troop numbers
4. **Tech Progression**: Research tree for upgrades
5. **Resource Variety**: Energy + Credits + Minerals + Research
6. **Visual Spectacle**: Space battles with full effects
7. **Strategic Depth**: Z-axis tactics, nebula hiding, asteroid mining

---

## NOTES FOR AI IMPLEMENTATION

- Start with Phase 1 basic systems before adding complexity
- Use Three.js InstancedMesh for performance with many objects
- Implement Supabase Realtime for multiplayer sync
- Keep combat calculations server-side to prevent cheating
- Use spatial hashing for efficient proximity detection in 3D
- Design UI for both desktop and potential mobile compatibility
- Prioritize smooth 60 FPS even with 1000+ objects on screen
- Consider WebGL 2.0 features for better performance
- Implement progressive loading for textures and models
